{% extends "base.html" %}

{% block content %}
{% load static %}
<form method="POST" action="{% url 'display_snippets' %}?frag1={{ frag1 }}&place1={{ place1 }}&frag2={{ frag2 }}&place2={{ place2 }}&edit={{ edit_mode }}">
    {% csrf_token %}
    {% if request.GET.saved == 'true' %}
        <h2 style="color : green">Izmaiņas saglabātas.</h2>
    {% endif %}
    <table>
        <tr>
            <th>Fragments 1: {{ snippet1.filename }}</th>
            <th>Fragments 2: {{ snippet2.filename }}</th>
        </tr>
        <tr>
            <td>
                {% if snippet1 %}
                    <img src="{% static snippet1.filename %}" alt="Snippet Image 1" style="width: 50%;">
                {% else %}
                    Šāds fragments neeksistē.
                {% endif %}
            </td>
            <td>
                {% if snippet2 %}
                    <img src="{% static snippet2.filename %}" alt="Snippet Image 2" style="width: 50%;">
                {% else %}
                    Šāds fragments neeksistē.
                {% endif %}</td>
        </tr>
        <tr>
            <td>
                {% if display_scroll_left %}
                    <a href="{% url 'display_snippets' %}?frag1={{ prev_frag1 }}&place1={{ prev_place1 }}&frag2={{ prev_frag2 }}&place2={{ prev_place2 }}&edit={{ edit_mode }}">Iepriekšējā</a>
                {% endif %}
                <button type="submit">Saglabāt izmaiņas</button>
                {% if display_scroll_right %}
                    <a href="{% url 'display_snippets' %}?frag1={{ next_frag1 }}&place1={{ next_place1 }}&frag2={{ next_frag2 }}&place2={{ next_place2 }}&edit={{ edit_mode }}">Nākamā</a>
                {% endif %}

                {% if show_combine_checkbox %}
                    <input type="checkbox" name="combine" id="combine">
                    <label for="combine">Combine</label>
                {% endif %}
                {% if show_validate_1 %}
                    <input type="checkbox" name="validate_1" id="validate_1">
                    <label for="validate_1">Validate segment {{ frag1 }}</label>
                {% endif %}

            </td>

            <td>
                {% if show_split_checkbox %}
                    <input type="checkbox" name="split" id="split">
                    <label for="split">Split segment</label>
                {% endif %}
                {% if show_validate_2 %}
                    <input type="checkbox" name="validate_2" id="validate_2">
                    <label for="validate_2">Validate segment {{ frag2 }}</label>
                {% endif %}

            </td>
        </tr>
        {% if edit_mode %}<tr>
            <td>
                Fragmenta vieta: <strong>{{ frag1 }} - {{ place1 }} </strong> Snippet id: {{ snippet1.id }}<br>
                Weekday: <strong>{% if snippet1.weekday %}{{ snippet1.get_weekday_display }}{% else %}N/A{% endif %}</strong> Earliest time:
                    <strong>{% if snippet1.first_time %}
                        {{ snippet1.first_time|date:"H:i" }}
                    {% else %}
                        N/A
                    {% endif %}</strong>
                Latest time:
                    <strong>{% if snippet1.last_time %}
                        {{ snippet1.last_time|date:"H:i" }}
                    {% else %}
                        N/A
                    {% endif %}</strong>
            </td>
            <td>
                Fragmenta vieta: <strong>{{ frag2 }} - {{ place2 }} </strong> Snippet id: {{ snippet2.id }}<br>
                Weekday: <strong>{% if snippet2.weekday %}{{ snippet2.get_weekday_display }}{% else %}N/A{% endif %}</strong> Earliest time:
                    <strong>{% if snippet2.first_time %}
                        {{ snippet2.first_time|date:"H:i" }}
                    {% else %}
                        N/A
                    {% endif %}</strong>
                Latest time:
                    <strong>{% if snippet2.last_time %}
                        {{ snippet2.last_time|date:"H:i" }}
                    {% else %}
                        N/A
                    {% endif %}</strong>
            </td>
        </tr>
        <tr>
            <td>
                <!-- Inputs for navigating from snippet1 -->
                Navigate to:
                <input type="text" name="nav_frag1" placeholder="Frag" size="3" value="{{ frag1 }}">
                <input type="text" name="nav_place1" placeholder="Place" size="3" value="{{ place1 }}">
                {% if prior_segment_frag1 and edit_mode %}
                    <a href="{% url 'display_snippets' %}?frag1={{ prior_segment_frag1 }}&place1={{ prior_segment_place1 }}&frag2={{ frag2 }}&place2={{ place2 }}&edit={{ edit_mode }}">Prior segment </a>
                {% endif %}
                {% if display_prev1 and edit_mode %}
                    <a href="{% url 'display_snippets' %}?frag1={{ prev_frag1 }}&place1={{ prev_place1 }}&frag2={{ frag2 }}&place2={{ place2 }}&edit={{ edit_mode }}"><--</a>
                {% endif %}
                {% if display_next1 and edit_mode %}
                    <a href="{% url 'display_snippets' %}?frag1={{ next_frag1 }}&place1={{ next_place1 }}&frag2={{ frag2 }}&place2={{ place2 }}&edit={{ edit_mode }}">--></a>
                {% endif %}
                {% if max_place_segment_1 and edit_mode %}
                    <a href="{% url 'display_snippets' %}?frag1={{ frag1 }}&place1={{ max_place_segment_1 }}&frag2={{ frag2 }}&place2={{ place2 }}&edit={{ edit_mode }}"> Last </a>
                {% endif %}
                {% if next_segment_frag1 and edit_mode %}
                    <a href="{% url 'display_snippets' %}?frag1={{ next_segment_frag1 }}&place1={{ next_segment_place1 }}&frag2={{ frag2 }}&place2={{ place2 }}&edit={{ edit_mode }}">Next segment </a>
                {% endif %}
            </td>
            <td>
                <!-- Inputs for navigating from snippet2 -->
                Navigate to:
                <input type="text" name="nav_frag2" placeholder="Frag" size="3" value="{{ frag2 }}">
                <input type="text" name="nav_place2" placeholder="Place" size="3" value="{{ place2 }}">
                {% if prior_segment_frag2 and edit_mode %}
                    <a href="{% url 'display_snippets' %}?frag1={{ frag1 }}&place1={{ place1 }}&frag2={{ prior_segment_frag2 }}&place2={{ prior_segment_place2 }}&edit={{ edit_mode }}">Prior segment </a>
                {% endif %}
                {% if display_prev2 and edit_mode %}
                    <a href="{% url 'display_snippets' %}?frag1={{ frag1 }}&place1={{ place1 }}&frag2={{ prev_frag2 }}&place2={{ prev_place2 }}&edit={{ edit_mode }}"><--</a>
                {% endif %}
                {% if display_next2 and edit_mode %}
                    <a href="{% url 'display_snippets' %}?frag1={{ frag1 }}&place1={{ place1 }}&frag2={{ next_frag2 }}&place2={{ next_place2 }}&edit={{ edit_mode }}">--></a>
                {% endif %}
                {% if max_place_segment_2 and edit_mode %}
                    <a href="{% url 'display_snippets' %}?frag1={{ frag1 }}&place1={{ place1 }}&frag2={{ frag2 }}&place2={{ max_place_segment_2 }}&edit={{ edit_mode }}"> Last </a>
                {% endif %}
                {% if next_segment_frag2 and edit_mode %}
                    <a href="{% url 'display_snippets' %}?frag1={{ frag1 }}&place1={{ place1 }}&frag2={{ next_segment_frag2 }}&place2={{ next_segment_place2 }}&edit={{ edit_mode }}">Next segment </a>
                {% endif %}

            </td>
        </tr>
        <tr>
            <td>
                Snippet before this one:<br>
                {% for overlap in top_ssim_overlaps_as_first_snippet1 %}
                    Overlapped by <a href="{% url 'display_snippets' %}?frag1={{ overlap.first_snippet.segment.id }}&place1={{ overlap.first_snippet.place }}&frag2={{ frag1 }}&place2={{ place1 }}&edit=True">{{ overlap.first_snippet.segment.id }}-{{ overlap.first_snippet.place }} ({{ overlap.first_snippet.id }})</a>: {{ overlap.overlaprowcount }} rows. <u>ssim: {{ overlap.ssim_score }}</u> time diff: {{ overlap.time_diff|date:"H:i" }}<br>
                {% endfor %}
                {% for overlap in top_time_overlaps_as_first_snippet1 %}
                    Overlapped by <a href="{% url 'display_snippets' %}?frag1={{ overlap.first_snippet.segment.id }}&place1={{ overlap.first_snippet.place }}&frag2={{ frag1 }}&place2={{ place1 }}&edit=True">{{ overlap.first_snippet.segment.id }}-{{ overlap.first_snippet.place }} ({{ overlap.first_snippet.id }})</a>: {{ overlap.overlaprowcount }} rows. ssim: {{ overlap.ssim_score }} <u>time diff: {{ overlap.time_diff|date:"H:i" }}</u><br>
                {% endfor %}

                Snippet after this one:<br>
                {% for overlap in top_ssim_overlaps_as_second_snippet1 %}
                    Overlaps with <a href="{% url 'display_snippets' %}?frag1={{ frag1 }}&place1={{ place1 }}&frag2={{ overlap.second_snippet.segment.id }}&place2={{ overlap.second_snippet.place }}&edit=True">{{ overlap.second_snippet.segment.id }}-{{ overlap.second_snippet.place }} ({{ overlap.second_snippet.id }})</a>: {{ overlap.overlaprowcount }} rows. <u>ssim: {{ overlap.ssim_score }}</u> time diff: {{ overlap.time_diff|date:"H:i" }}<br>
                {% endfor %}
                {% for overlap in top_time_overlaps_as_second_snippet1 %}
                    Overlaps with <a href="{% url 'display_snippets' %}?frag1={{ frag1 }}&place1={{ place1 }}&frag2={{ overlap.second_snippet.segment.id }}&place2={{ overlap.second_snippet.place }}&edit=True">{{ overlap.second_snippet.segment.id }}-{{ overlap.second_snippet.place }} ({{ overlap.second_snippet.id }})</a>: {{ overlap.overlaprowcount }} rows. ssim: {{ overlap.ssim_score }} <u>time diff: {{ overlap.time_diff|date:"H:i" }}</u><br>
                {% endfor %}

            </td>
            <td>
                Snippet before this one:<br>
                {% for overlap in top_ssim_overlaps_as_first_snippet2 %}
                    Overlapped by <a href="{% url 'display_snippets' %}?frag1={{ overlap.first_snippet.segment.id }}&place1={{ overlap.first_snippet.place }}&frag2={{ frag2 }}&place2={{ place2 }}&edit=True">{{ overlap.first_snippet.segment.id }}-{{ overlap.first_snippet.place }} ({{ overlap.first_snippet.id }})</a>: {{ overlap.overlaprowcount }} rows. <u>ssim: {{ overlap.ssim_score }}</u> time diff: {{ overlap.time_diff|date:"H:i" }}<br>
                {% endfor %}
                {% for overlap in top_time_overlaps_as_first_snippet2 %}
                    Overlapped by <a href="{% url 'display_snippets' %}?frag1={{ overlap.first_snippet.segment.id }}&place1={{ overlap.first_snippet.place }}&frag2={{ frag2 }}&place2={{ place2 }}&edit=True">{{ overlap.first_snippet.segment.id }}-{{ overlap.first_snippet.place }} ({{ overlap.first_snippet.id }})</a>: {{ overlap.overlaprowcount }} rows. ssim: {{ overlap.ssim_score }} <u>time diff: {{ overlap.time_diff|date:"H:i" }}</u><br>
                {% endfor %}
                Snippet after this one:<br>
                {% for overlap in top_ssim_overlaps_as_second_snippet2 %}
                    Overlaps with <a href="{% url 'display_snippets' %}?frag1={{ frag2 }}&place1={{ place2 }}&frag2={{ overlap.second_snippet.segment.id }}&place2={{ overlap.second_snippet.place }}&edit=True">{{ overlap.second_snippet.segment.id }}-{{ overlap.second_snippet.place }} ({{ overlap.second_snippet.id }})</a>: {{ overlap.overlaprowcount }} rows. <u>ssim: {{ overlap.ssim_score }}</u> time diff: {{ overlap.time_diff|date:"H:i" }}<br>
                {% endfor %}
                {% for overlap in top_time_overlaps_as_second_snippet2 %}
                    Overlaps with <a href="{% url 'display_snippets' %}?frag1={{ frag2 }}&place1={{ place2 }}&frag2={{ overlap.second_snippet.segment.id }}&place2={{ overlap.second_snippet.place }}&edit=True">{{ overlap.second_snippet.segment.id }}-{{ overlap.second_snippet.place }} ({{ overlap.second_snippet.id }})</a>: {{ overlap.overlaprowcount }} rows. ssim: {{ overlap.ssim_score }} <u>time diff: {{ overlap.time_diff|date:"H:i" }}</u><br>
                {% endfor %}
            </td>
        </tr>
        <tr>
            <td>
                Search phrase: <input type="text" name="search_left" size="40" value="{{ search_phrase_left }}"><br>
                    {% if search_dict_left %}
                        <p>Search Results:</p>
                        <ul>
                             {% for id, snippet in search_dict_left.items %}
                                <li>
                                    <a href="{% url 'display_snippets' %}?frag1={{ frag1 }}&place1={{ place1 }}&frag2={{ snippet.segment_id }}&place2={{ snippet.place }}&edit=True">
                                        Snippet ID: {{ id }}, Segment: {{ snippet.segment_id }}, Place: {{ snippet.place }}
                                    </a>
                                </li>
                            {% endfor %}
                        </ul>
                    {% else %}
                        <p>No search results found.</p>
                    {% endif %}
            </td>
            <td>
                Search phrase: <input type="text" name="search_right" size="40" value="{{ search_phrase_right }}"><br>
                    {% if search_dict_right %}
                        <p>Search Results:</p>
                        <ul>
                             {% for id, snippet in search_dict_right.items %}
                                <li>
                                    <a href="{% url 'display_snippets' %}?frag1={{ snippet.segment_id }}&place1={{ snippet.place }}&frag2={{ frag2 }}&place2={{ place2 }}&edit=True">
                                        Snippet ID: {{ id }}, Segment: {{ snippet.segment_id }}, Place: {{ snippet.place }}
                                    </a>
                                </li>
                            {% endfor %}
                        </ul>
                    {% else %}
                        <p>No search results found.</p>
                    {% endif %}
            </td>
        </tr>
        {% endif %}
        <tr>
            <td>
                {% if edit_mode %}
                    {% for sentence in sentences1 %}
                        {% if sentence.speaker == "0" %}Mīļā
                        {% else %}Mīļais
                        {% endif %} ({{ sentence.time|date:"H:i" }}):
                            <input type="checkbox" name="delete_sentence_{{ sentence.id }}" id="delete_sentence_{{ sentence.id }}">
                            <label for="delete_sentence_{{ sentence.id }}">Delete</label>
                            <input type="hidden" name="sentence_id_{{ sentence.id }}" value="{{ sentence.id }}">
                            <textarea name="sentence_text_{{ sentence.id }}" cols="70">{{ sentence.text }}</textarea><br>
                    {% endfor %}
                {% else %}
                {% endif %}
            </td>
            <td>
                {% if edit_mode %}
                    {% for sentence in sentences2 %}
                        {% if sentence.speaker == "0" %}Mīļā
                        {% else %}Mīļais
                        {% endif %} ({{ sentence.time|date:"H:i" }}):
                            <input type="checkbox" name="delete_sentence_{{ sentence.id }}" id="delete_sentence_{{ sentence.id }}">
                            <label for="delete_sentence_{{ sentence.id }}">Delete</label>
                            <input type="hidden" name="sentence_id_{{ sentence.id }}" value="{{ sentence.id }}">
                            <textarea name="sentence_text_{{ sentence.id }}" cols="70">{{ sentence.text }}</textarea><br>
                    {% endfor %}
                {% else %}
                {% endif %}
            </td>
        </tr>
        <tr>
            <!-- Checkboxes for loved field -->
            <td>
                Mīlēts?
                <input type="checkbox" name="loved1" {% if user_snippet1.loved %}checked{% endif %}>
                Atzīmēts?
                <input type="checkbox" name="marked1" {% if user_snippet1.marked %}checked{% endif %}>
            </td>
            <td>
                Mīlēts?
                <input type="checkbox" name="loved2" {% if user_snippet2.loved %}checked{% endif %}>
                Atzīmēts?
                <input type="checkbox" name="marked2" {% if user_snippet2.marked %}checked{% endif %}>
            </td>
        </tr>

        <tr>
            <td>
            <!-- Radio buttons for existing summaries for snippet1 -->
            {% for summary in summaries %}
                <input type="radio" id="summary1_{{ summary.id }}" name="selected_summary1" value="{{ summary.id }}" {% if snippet1.summary and summary.id == snippet1.summary.id %}checked{% endif %}>
                <label for="summary1_{{ summary.id }}">{{ summary.title }}</label><br>
            {% endfor %}
            <!-- Textarea for new summary for snippet1 -->
            <textarea name="new_summary1" cols="70" placeholder="Jauns apraksts"></textarea>
        </td>
        <td>
            <!-- Radio buttons for existing summaries for snippet2 -->
            {% for summary in summaries %}
                <input type="radio" id="summary2_{{ summary.id }}" name="selected_summary2" value="{{ summary.id }}" {% if snippet2.summary and summary.id == snippet2.summary.id %}checked{% endif %}>
                <label for="summary2_{{ summary.id }}">{{ summary.title }}</label><br>
            {% endfor %}
            <!-- Textarea for new summary for snippet2 -->
            <textarea name="new_summary2" cols="70" placeholder="Jauns apraksts"></textarea>
        </td>
        </tr>

        <!-- Repeat for other fields like text, summary title, checkboxes, etc. -->
    </table>
</form>
{% endblock %}
