{% extends "base.html" %}

{% block content %}
{% load static %}
<form method="POST" action="{% url 'display_snippets' %}?frag1={{ frag1 }}&place1={{ place1 }}&frag2={{ frag2 }}&place2={{ place2 }}&edit={{ edit_mode }}">
    {% csrf_token %}
    {% if request.GET.saved == 'true' %}
        <h2 style="color : green">Izmaiņas saglabātas.</h2>
    {% endif %}
    <table>
        <tr>
            <th>Fragments 1</th>
            <th>Fragments 2</th>
        </tr>
        <tr>
            <td>
                {% if snippet1 %}
                    <img src="{% static snippet1.filename %}" alt="Snippet Image 1" style="width: 50%;">
                {% else %}
                    Šāds fragments neeksistē.
                {% endif %}
            </td>
            <td>
                {% if snippet2 %}
                    <img src="{% static snippet2.filename %}" alt="Snippet Image 2" style="width: 50%;">
                {% else %}
                    Šāds fragments neeksistē.
                {% endif %}</td>
        </tr>
        <tr>
            <td>
                {% if frag1 == "1" and place1 == "1" %}
                {% else %}
                    <a href="{% url 'display_snippets' %}?frag1={{ prev_frag1 }}&place1={{ prev_place1 }}&frag2={{ prev_frag2 }}&place2={{ prev_place2 }}&edit={{ edit_mode }}">Iepriekšējā</a>
                {% endif %}
                <button type="submit">Saglabāt izmaiņas</button>
                {% if frag2 == max_segment and place2 == max_place %}
                {% else %}
                    <a href="{% url 'display_snippets' %}?frag1={{ next_frag1 }}&place1={{ next_place1 }}&frag2={{ next_frag2 }}&place2={{ next_place2 }}&edit={{ edit_mode }}">Nākamā</a>
                {% endif %}
            </td>

        </tr>
        <tr>
            <!-- Checkboxes for loved field -->
            <td>
                Mīlēts?
                <input type="checkbox" name="loved1" {% if user_snippet1.loved %}checked{% endif %}>
            </td>
            <td>
                Mīlēts?
                <input type="checkbox" name="loved2" {% if user_snippet2.loved %}checked{% endif %}>
            </td>
        </tr>
        <tr>
            <!-- Checkboxes for marked field -->
            <td>
                Atzīmēts?
                <input type="checkbox" name="marked1" {% if user_snippet1.marked %}checked{% endif %}>
            </td>
            <td>
                Atzīmēts?
                <input type="checkbox" name="marked2" {% if user_snippet2.marked %}checked{% endif %}>
            </td>
        </tr>
        {% if edit_mode %}<tr>
            <td>
                Fragmenta vieta: <strong>{{ frag1 }} - {{ place1 }} </strong><br>
                Prior overlap: <strong>{% if prev_snippet_exists %}{{ prev_snippet.overlaprowcount }}{% else %} No prior snippet.{% endif %}</strong> Next overlap: <strong>{{ snippet1.overlaprowcount }}</strong><br>
                Weekday: <strong>{{ snippet1.weekday }}</strong> Earliest time: <strong>{{ snippet1.first_time }}</strong> Latest time: <strong>{{ snippet1.last_time }}</strong>
            </td>
            <td>
                Fragmenta vieta: <strong>{{ frag2 }} - {{ place2 }} </strong><br>
                Prior overlap: <strong>{{ snippet1.overlaprowcount }}</strong> Next overlap: <strong>{{ snippet2.overlaprowcount }}</strong><br>
                Weekday: <strong>{{ snippet2.weekday }}</strong> Earliest time: <strong>{{ snippet2.first_time }}</strong> Latest time: <strong>{{ snippet2.last_time }}</strong>
            </td>
        </tr>{% endif %}
        <tr>
            <td>
                {% if edit_mode %}
                    {% for sentence in sentences1 %}
                        {% if sentence.speaker == 0 %}Mīļā
                        {% else %}Mīļais
                        {% endif %} ({{ sentence.time|date:"H:i" }}): <input type="hidden" name="sentence_id_{{ sentence.id }}" value="{{ sentence.id }}">
                    <textarea name="sentence_text_{{ sentence.id }}" cols="70">{{ sentence.text }}</textarea><br>
                    {% endfor %}
                {% else %}
                {% endif %}
            </td>
            <td>
                {% if edit_mode %}
                    {% for sentence in sentences2 %}
                        {% if sentence.speaker == 0 %}Mīļā
                        {% else %}Mīļais
                        {% endif %} ({{ sentence.time|date:"H:i" }}): <input type="hidden" name="sentence_id_{{ sentence.id }}" value="{{ sentence.id }}">
                    <textarea name="sentence_text_{{ sentence.id }}" cols="70">{{ sentence.text }}</textarea><br>
                    {% endfor %}
                {% else %}
                {% endif %}
            </td>
        </tr>
        <tr>
            <td>
            <!-- Radio buttons for existing summaries for snippet1 -->
            {% for summary in summaries %}
                <input type="radio" id="summary1_{{ summary.id }}" name="selected_summary1" value="{{ summary.id }}" {% if snippet1.summary and summary.id == snippet1.summary.id %}checked{% endif %}>
                <label for="summary1_{{ summary.id }}">{{ summary.title }}</label><br>
            {% endfor %}
            <!-- Textarea for new summary for snippet1 -->
            <textarea name="new_summary1" cols="70" placeholder="Jauns apraksts"></textarea>
        </td>
        <td>
            <!-- Radio buttons for existing summaries for snippet2 -->
            {% for summary in summaries %}
                <input type="radio" id="summary2_{{ summary.id }}" name="selected_summary2" value="{{ summary.id }}" {% if snippet2.summary and summary.id == snippet2.summary.id %}checked{% endif %}>
                <label for="summary2_{{ summary.id }}">{{ summary.title }}</label><br>
            {% endfor %}
            <!-- Textarea for new summary for snippet2 -->
            <textarea name="new_summary2" cols="70" placeholder="Jauns apraksts"></textarea>
        </td>
        </tr>

        <!-- Repeat for other fields like text, summary title, checkboxes, etc. -->
    </table>
</form>
{% endblock %}
